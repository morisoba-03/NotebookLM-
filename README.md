# NotebookLM Input Hub

テキストメモと画像をNotebookLMに追加するためのシンプルなWebアプリケーションです。

## ? 機能

1. **テキストメモ追加**: Googleドキュメントの末尾に `[YYYY-MM-DD HH:mm:ss JST] テキスト` 形式で追記
2. **画像追加**: Google Slidesに画像を1枚=1スライドで追加し、PDFに書き出して既存PDFファイルを上書き

## ? 構成

```
NotebookLM用/
├── frontend/
│   ├── index.html      # メインHTML
│   ├── app.js          # フロントエンドロジック
│   └── style.css       # スタイルシート
├── backend-gas/
│   ├── Code.gs         # Google Apps Scriptコード
│   └── appsscript.json # GAS設定ファイル
└── README.md           # このファイル
```

## ? セットアップ手順（完全版）

### ステップ1: 必要なGoogle Driveファイルを準備（5分）

#### 1-1. Googleドキュメントの確認
? すでにお持ちのドキュメントがあります！
- **URL**: https://docs.google.com/document/d/1cR6575SP7YB9QquRgkH7qOInjTnak4vet0EJ-q6CNXQ/edit
- **ID**: `1cR6575SP7YB9QquRgkH7qOInjTnak4vet0EJ-q6CNXQ`

このドキュメントにテキストメモが追記されます。

#### 1-2. Googleスライドの作成
1. [Google Drive](https://drive.google.com)にアクセス
2. 左上の「新規」→「Googleスライド」→「空白のプレゼンテーション」をクリック
3. スライド名を「NotebookLM 画像ソース」などに変更
4. 最初の1枚のスライドは削除してもOK（画像追加時に新しいスライドが自動で追加されます）
5. URLから**スライドID**をコピー
   ```
   URL例: https://docs.google.com/presentation/d/【ここがID】/edit
   ```
   - 「/d/」と「/edit」の間の文字列がIDです
6. このIDをメモ帳などに控えておく

> **例**: `https://docs.google.com/presentation/d/1ABC...XYZ/edit`  
> この場合、IDは `1ABC...XYZ` です

---

### ステップ2: NotebookLMにソースを登録（3分）

1. [NotebookLM](https://notebooklm.google.com/)にアクセス
2. 新しいノートブックを作成（または既存のものを開く）
3. **「ソースを追加」**をクリック

#### ソース1: Googleドキュメント
1. 「Googleドキュメント」を選択
2. 先ほどのドキュメント（`1cR6575SP7YB9QquRgkH7qOInjTnak4vet0EJ-q6CNXQ`）を選択
3. 「追加」をクリック

#### ソース2: Googleスライド
1. もう一度「ソースを追加」をクリック
2. 「Googleスライド」を選択
3. ステップ1-2で作成したスライドを選択
4. 「追加」をクリック

? これで2つのソースが登録されました！
- ? Googleドキュメント（テキストメモ用）
- ?? Googleスライド（画像用）

> **重要**: NotebookLMへの反映には**5?10分**かかります

---

### ステップ3: Google Apps Scriptの設定

#### 3-1. Apps Scriptプロジェクトの作成
1. [Google Apps Script](https://script.google.com/)にアクセス
2. 左上「新しいプロジェクト」をクリック
3. プロジェクト名を「NotebookLM Input Hub」などに変更（左上の「無題のプロジェクト」をクリック）

#### 3-2. コードの貼り付け
1. 左側のファイル一覧で「コード.gs」を選択
2. すべての内容を削除し、`backend-gas/Code.gs` の内容をコピー&ペースト
3. 左側のファイル一覧の「?? プロジェクトの設定」アイコンをクリック
4. 下にスクロールして「appsscript.json」マニフェスト ファイルをエディタで表示する」にチェック
5. 左側に「appsscript.json」が表示されるのでクリック
6. すべての内容を削除し、`backend-gas/appsscript.json` の内容をコピー&ペースト

#### 3-4. 設定値の編集
1. 「コード.gs」ファイルを開く
2. 冒頭の設定部分を編集：

```javascript
// 強力なランダム文字列に変更してください（20文字以上推奨）
const API_KEY = 'mySecret2024!Notebook#LM_xyz123';

// すでに設定済み（変更不要）
const DOC_ID = '1cR6575SP7YB9QquRgkH7qOInjTnak4vet0EJ-q6CNXQ';

// ステップ1-2で控えたスライドIDを貼り付け
const SLIDES_ID = 'ここにスライドIDを貼り付け';
```

> **API_KEYの作り方**: 適当な英数字記号を混ぜた20文字以上の文字列を作ってください。例: `mySecret2024!Notebook#LM`

3. 保存アイコン（?）をクリック

#### 3-5. 動作確認テスト
1. 上部の関数プルダウンで「checkConfig」を選択
2. 「実行」ボタン（??）をクリック
3. 初回は権限の承認が必要です：
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「NotebookLM Input Hub（安全ではないページ）に移動」をクリック
   - 「許可」をクリック
4. 下部の「実行ログ」に「? Googleドキュメントにアクセス可能」などと表示されればOK

---

### ステップ4: WebアプリとしてデプロイAT

1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 左上の「種類の選択」（??アイコン）→「ウェブアプリ」を選択
3. 以下のように設定：
   - **説明**: 「v1」など（任意）
   - **次のユーザーとして実行**: 「自分」を選択
   - **アクセスできるユーザー**: 「全員」を選択
4. 「デプロイ」をクリック
5. 「ウェブアプリのURL」が表示されるので、**URLをコピー**（後で使います）
   - 例: `https://script.google.com/macros/s/ABC.../exec`
6. 「完了」をクリック

> **注意**: 「全員」に設定しても、API_KEYによる認証があるので安全です。

---

### ステップ5: フロントエンドの設定

#### 5-1. app.jsの編集
1. `frontend/app.js` をメモ帳やVS Codeなどで開く
2. 冒頭の設定部分を編集：

```javascript
// ステップ4でコピーしたWebアプリURLを貼り付け
const ENDPOINT = "https://script.google.com/macros/s/ABC123XYZ.../exec";

// Code.gsで設定したのと同じAPI_KEYを貼り付け
const API_KEY = "mySecret2024!Notebook#LM_xyz123";

// すでに設定済み（確認のみ）
const DOC_ID = "1cR6575SP7YB9QquRgkH7qOInjTnak4vet0EJ-q6CNXQ";

// ステップ1-2で控えたスライドIDを貼り付け
const SLIDES_ID = "ここにスライドIDを貼り付け";
```

3. 保存

---

### ステップ6: 動作確認

#### 6-1. ローカルで開く
1. `frontend/index.html` をダブルクリックしてブラウザで開く
2. または、ブラウザに `index.html` をドラッグ&ドロップ

#### 6-2. テキストメモのテスト
1. テキスト入力欄に「テスト投稿」などと入力
2. 「メモを追加」ボタンをクリック
3. 「? メモを追加しました」と表示されればOK
4. Googleドキュメントを開いて、`4. Googleドキュメントを開いて確認：
   ```
   [2025-10-25 14:30:45 JST] テスト投稿
   ```
   このような形式で追記されていればOK！

#### 6-3. 画像のテスト
1. 「**? 画像を選択**」をクリック
2. JPEG/PNG画像を1枚選択
3. （オプション）注記欄に「テスト画像」と入力
4. 「**画像を追加**」ボタンをクリック
5. ? 「**1枚の画像をスライドに追加しました**」と表示されればOK
6. Googleスライドを開いて確認：
   - 新しいスライドが追加されている
   - 画像が全画面にフィット表示されている
   - 右下に `[2025-10-25 14:32 JST] テスト画像` のような注記がある

#### 6-4. NotebookLMで確認（5分後）
1. NotebookLMを開く
2. **5?10分待つ**（Googleが同期するのを待ちます）
3. チャットで質問してみる：
   - 「最新のメモを教えて」
   - 「今日追加した画像について教えて」
   - 「テスト投稿について説明して」
4. NotebookLMが内容を認識していればOK！` のような形式で追記されているか確認

#### 6-3. 画像のテスト
1. 「画像を選択」をクリックして、JPEG/PNG画像を1枚選択
2. （オプション）注記欄に「テスト画像」などと入力
3. 「画像を追加」ボタンをクリック
4. 「? 1枚の画像を追加しました」と表示されればOK
5. Googleスライドを開いて、新しいスライドに画像が追加されているか確認
6. Google DriveのPDFファイルを開いて、画像が含まれているか確認
7. NotebookLMで数分待って、画像の内容が反映されているか確認（チャットで「最新の画像について教えて」など）

---

## ? トラブルシューティング

### エラー: 「unauthorized」
- **原因**: `app.js` の `API_KEY` と `Code.gs` の `API_KEY` が一致していません
- **解決**: 両方のファイルで同じAPI_KEYに設定してください

### エラー: 「JSONパースエラー」
- **原因**: ネットワークエラーまたはGASのURLが間違っています
- **解決**: `app.js` の `ENDPOINT` が正しいか確認してください

### 画像が追加されない
- **原因**: SLIDES_IDが間違っている、または権限がありません
- **解決**: 
  1. スライドのURLからIDを再確認
  2. Apps Scriptの実行ユーザーがそのスライドにアクセスできるか確認
  3. `checkConfig`関数を実行してログを確認

### NotebookLMに反映されない
- **原因**: Googleの同期に時間がかかっています
- **解決**: 
  1. 5?10分待ってから再度確認
  2. NotebookLMでソースを一度削除して再追加
  3. Googleドキュメント/スライドを直接開いて、内容が追加されているか確認

### ボタンを押しても反応しない
- **原因**: ENDPOINTが未設定
- **解決**: 
  1. ブラウザの開発者ツールを開く（F12キー）
  2. 「Console」タブでエラーメッセージを確認
  3. `app.js`のENDPOINTとAPI_KEYが正しく設定されているか確認

---

## ? 使い方

### 日常的な利用方法

#### テキストメモを追加
1. HTMLを開く
2. テキストエリアにメモを入力
3. 「メモを追加」ボタンをクリック
4. Googleドキュメントに自動追記されます

#### 画像を追加
1. HTMLを開く
2. 「画像を選択」から1枚または複数枚を選択
3. （任意）注記を入力
4. 「画像を追加」ボタンをクリック
5. Googleスライドに自動で追加されます

#### NotebookLMで確認
1. 5?10分待つ
2. NotebookLMでチャット
3. 「最新のメモを要約して」「今日追加した画像について教えて」などと質問

---

## ? セキュリティ

- **API_KEY**: フロントとバックエンドで共有する秘密鍵です。他人に知られないようにしてください
- **CORS**: シンプルリクエスト方式のため、プリフライトは発生しません
- **ファイルサイズ制限**: 画像の合計サイズは30MBまで

---

## ? カスタマイズ

### タイムスタンプ形式を変更
`Code.gs` の `Utilities.formatDate` の第3引数を変更：
```javascript
"yyyy/MM/dd HH:mm"  // 2025/10/25 12:34
```

### スタイルを変更
`frontend/style.css` を編集してお好みの色やレイアウトに変更できます。

### 画像の配置を変更
`Code.gs` の `handleImageMode` 関数内で、画像のサイズや位置を調整できます。

---

## ? 今後の拡張案

- [ ] 音声メモの文字起こし追加
- [ ] スクリーンショット直接貼り付け対応
- [ ] タグ機能（#タグでの分類）
- [ ] メモの検索機能
- [ ] PWA化（オフライン対応）
- [ ] Slack/LINE連携

---

## ? ライセンス

このプロジェクトはMITライセンスです。自由に改変・再配布できます。

---

## ? 質問・問題報告

不明な点やエラーが発生した場合は、以下を確認してください：

1. Google Apps Scriptの「実行ログ」（Code.gsで「実行」→下部の「実行ログ」タブ）
2. ブラウザの開発者ツール（F12キー）→「Console」タブ
3. このREADMEのトラブルシューティング章

それでも解決しない場合は、エラーメッセージをコピーして検索するか、詳しい人に相談してください。

---

**作成日**: 2025-10-25  
**バージョン**: 2.0（PDF不要版）
